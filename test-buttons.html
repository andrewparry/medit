<!DOCTYPE html>
<html>
<head>
    <title>Button Test</title>
</head>
<body>
    <textarea id="editor" style="width: 100%; height: 200px;">Test content</textarea>
    <button id="linkBtn">Insert Link</button>
    <button id="imageBtn">Insert Image</button>
    
    <script>
        const editor = document.getElementById('editor');
        
        const getSelection = () => ({
            start: editor.selectionStart,
            end: editor.selectionEnd,
            value: editor.value
        });
        
        const setSelection = (start, end) => {
            editor.focus();
            editor.setSelectionRange(start, end);
        };
        
        const replaceSelection = (text, selectionRange) => {
            const { start, end, value } = getSelection();
            const before = value.slice(0, start);
            const after = value.slice(end);
            editor.value = `${before}${text}${after}`;
            let newStart, newEnd;

            if (selectionRange && typeof selectionRange === 'object') {
                newStart = start + selectionRange.start;
                newEnd = start + selectionRange.end;
            } else {
                const offset = typeof selectionRange === 'number' ? selectionRange : text.length;
                newStart = start + offset;
                newEnd = newStart;
            }

            setSelection(newStart, newEnd);
        };
        
        const promptForInput = (message, defaultValue = '') => {
            const response = window.prompt(message, defaultValue);
            if (response === null) {
                return null;
            }
            return response.trim();
        };
        
        const insertLink = () => {
            console.log('insertLink called');
            const { start, end, value } = getSelection();
            const selectedText = value.slice(start, end);

            const url = promptForInput('Link URL (https://...)', 'https://');
            if (!url) {
                console.log('No URL provided');
                return;
            }

            const defaultText = selectedText || url;
            const textResponse = promptForInput('Link text (optional)', defaultText);
            if (textResponse === null) {
                console.log('Text prompt cancelled');
                return;
            }

            const linkText = textResponse || defaultText;
            const linkSyntax = `[${linkText}](${url})`;

            replaceSelection(linkSyntax, linkSyntax.length);
            console.log('Link inserted:', linkSyntax);
        };
        
        const insertImage = () => {
            console.log('insertImage called');
            const altResponse = promptForInput('Image description (alt text)', 'Image description');
            if (altResponse === null) {
                console.log('Alt text prompt cancelled');
                return;
            }

            const altText = altResponse || 'image';
            const url = promptForInput('Image URL (https://...)', 'https://');
            if (!url) {
                console.log('No URL provided');
                return;
            }

            const imageSyntax = `![${altText}](${url})`;
            replaceSelection(imageSyntax, imageSyntax.length);
            console.log('Image inserted:', imageSyntax);
        };
        
        document.getElementById('linkBtn').addEventListener('click', insertLink);
        document.getElementById('imageBtn').addEventListener('click', insertImage);
        
        console.log('Test page loaded');
    </script>
</body>
</html>
