<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Link & Image Button Test</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        textarea {
            width: 100%;
            height: 200px;
            padding: 10px;
            font-size: 14px;
            margin-bottom: 20px;
        }
        button {
            padding: 10px 20px;
            margin-right: 10px;
            font-size: 14px;
            cursor: pointer;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 5px;
        }
        .log {
            margin-top: 20px;
            padding: 15px;
            background: #e8f4f8;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Link & Image Button Test</h1>
    <p>Instructions:</p>
    <ol>
        <li>Type some text in the textarea (or select existing text)</li>
        <li>Click "Insert Link" or "Insert Image"</li>
        <li>Fill in the prompts</li>
        <li>Check the result below</li>
    </ol>
    
    <textarea id="editor">Select this text and click Insert Link</textarea>
    
    <div>
        <button id="linkBtn">üîó Insert Link</button>
        <button id="imageBtn">üñºÔ∏è Insert Image</button>
        <button id="clearBtn">Clear</button>
    </div>
    
    <div class="result">
        <strong>Current Content:</strong>
        <pre id="result"></pre>
    </div>
    
    <div class="log">
        <strong>Console Log:</strong>
        <div id="log"></div>
    </div>
    
    <script>
        const editor = document.getElementById('editor');
        const resultDiv = document.getElementById('result');
        const logDiv = document.getElementById('log');
        
        // Override console.log to show in page
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
            ).join(' ');
            logDiv.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        };
        
        const updateResult = () => {
            resultDiv.textContent = editor.value;
        };
        
        const getSelection = () => ({
            start: editor.selectionStart,
            end: editor.selectionEnd,
            value: editor.value
        });
        
        const setSelection = (start, end) => {
            editor.focus();
            editor.setSelectionRange(start, end);
        };
        
        const replaceSelection = (text, selectionRange) => {
            const { start, end, value } = getSelection();
            const before = value.slice(0, start);
            const after = value.slice(end);
            editor.value = `${before}${text}${after}`;
            let newStart, newEnd;

            if (selectionRange && typeof selectionRange === 'object') {
                newStart = start + selectionRange.start;
                newEnd = start + selectionRange.end;
            } else {
                const offset = typeof selectionRange === 'number' ? selectionRange : text.length;
                newStart = start + offset;
                newEnd = newStart;
            }

            setSelection(newStart, newEnd);
            updateResult();
        };
        
        const promptForInput = (message, defaultValue = '') => {
            const response = window.prompt(message, defaultValue);
            if (response === null) {
                return null;
            }
            return response.trim();
        };
        
        const insertLink = () => {
            console.log('insertLink function called');
            const { start, end, value } = getSelection();
            const selectedText = value.slice(start, end);
            console.log('Selected text:', selectedText);

            const url = promptForInput('Link URL (https://...)', 'https://');
            if (!url) {
                console.log('Link insertion cancelled - no URL');
                return;
            }

            const defaultText = selectedText || url;
            const textResponse = promptForInput('Link text (optional)', defaultText);
            if (textResponse === null) {
                console.log('Link insertion cancelled - no text');
                return;
            }

            const linkText = textResponse || defaultText;
            const linkSyntax = `[${linkText}](${url})`;

            console.log('Inserting link:', linkSyntax);
            replaceSelection(linkSyntax, linkSyntax.length);
        };
        
        const insertImage = () => {
            console.log('insertImage function called');
            const altResponse = promptForInput('Image description (alt text)', 'Image description');
            if (altResponse === null) {
                console.log('Image insertion cancelled - no alt text');
                return;
            }

            const altText = altResponse || 'image';
            const url = promptForInput('Image URL (https://...)', 'https://');
            if (!url) {
                console.log('Image insertion cancelled - no URL');
                return;
            }

            const imageSyntax = `![${altText}](${url})`;
            console.log('Inserting image:', imageSyntax);
            replaceSelection(imageSyntax, imageSyntax.length);
        };
        
        document.getElementById('linkBtn').addEventListener('click', (e) => {
            console.log('Link button clicked');
            insertLink();
        });
        
        document.getElementById('imageBtn').addEventListener('click', (e) => {
            console.log('Image button clicked');
            insertImage();
        });
        
        document.getElementById('clearBtn').addEventListener('click', () => {
            editor.value = '';
            logDiv.innerHTML = '';
            updateResult();
        });
        
        editor.addEventListener('input', updateResult);
        
        updateResult();
        console.log('Test page loaded successfully');
    </script>
</body>
</html>
